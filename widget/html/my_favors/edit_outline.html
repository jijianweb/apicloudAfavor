<!doctype html>
<html lang="en">

	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0" />
		<meta name="format-detection" content="telephone=no">
		<title>我的任务-我发布的任务 -任务详情-编辑-线下</title>
		<link rel="stylesheet" type="text/css" href="../../css/ct.css" />
		<link rel="stylesheet" type="text/css" href="../../css/swiper.min.css" />
		<style type="text/css">
			#main {
				padding: 20px 18px 0;
			}
			
			.title {
				text-align: center;
				color: #858CA0;
				font-size: 16px;
				padding-bottom: 7px;
				margin-top:16px;
			}
			
			.text,
			.date {
				padding: 0px 13px 0px 22px;
				border: 1px solid #C3C9CB;
				border-radius: 25px;
				color:#000000;
				width: 100%;
				height: 44px;
				line-height: 44px;
				font-size: 14px;
			}
			
			input[type="text"],
			textarea {
				width: 100%;
			}
			
			input[type="text"] {
				color: #000000;
			}
			
			.area {
				border: 1px solid #C3C9CB;
				background-color: white;
				border-radius: 8px;
				height:167px;
				width: 100%;
				padding:15px;
			}
			
			textarea {
				outline: none;
				resize: none;
				font-size: 12px;
				height:135px;
			}
			
			
			.name {
				margin-top: 15px;
			}
			
			.sty {
				padding: 0 17px 10px 21px;
				color: #828B8F;
				font-size: 14px;
			}
			
			
			.square {
				background-position: center;
				background-image: url(../../image/post/xiala.png);
				background-size: 12px 6px;
				background-repeat: no-repeat;
				width: 12px;
				height: 8px;
			}
			
			input[type="date"]::-webkit-calendar-picker-indicator {
				-webkit-appearance: none!important;
				-moz-appearance: none !important;
				appearance: none !important;
				visibility: hidden;
				position: relative;
				opacity: 0 !important;
				z-index: 998;
				display: none !important;
			}
			
			input[type='date'] {
				-moz-appearance: textfield;
				-webkit-appearance: none;
				width: 100%;
			}
			
			.t {
				color: #828B8F;
				font-size: 14px;
				padding: 5px 10px 6px 20px;
				margin-top: 10px;
			}
			
			.btn-o {
				border-radius: 25px;
				background-color: white;
				border:2px #32BBB1 solid;
			}
			
			.not-tilte {
				color: #32BBB1;
			}
			
			.not-tilte,
			.btn-tilte {
				font-size: 14px;
				text-align: center;
				padding: 10px 0;
			}
			
			.btn-tilte-on {
				border-bottom-right-radius: 25px;
				border-top-right-radius: 25px;
				background-color: #32BBB1;
				color: white;
			}
			
			.btn-tilte {
				border-bottom-left-radius: 25px;
				border-top-left-radius: 25px;
				background-color: #32BBB1;
				color: white;
			}
			
			.eh {
				margin-bottom: 10px;
				font-size:15px;
				color: #A6ACAE;
				width: 100%;
				text-align: center;
			}
			
			.up-down {
				background-size: 15px 15px;
				background-repeat: no-repeat;
				background-position: center;
				background-image: url(../../image/Shape-1.png);
				width: 20px;
				height: 20px;
			}
			
			.date-btn {
				background-color: #32BBB1;
				border-radius: 25px;
				text-align: center;
				padding: 3px;
				margin-top: 20px;
			}
			
			.date-e {
				padding: 10px 15px;
				border: 1px solid #828B90;
				border-radius: 25px;
				color: #D3D4D6;
				width: 100%;
				font-size: 12px;
			}
			
			.money{
				text-align: left;
				font-size:50px;
				position: relative;
				border: 1px solid #babfc1;
				border-radius:13px;
				width: 171px;
				height: 74px;
				line-height: 74px;
			}
			.tprice{
				color: #BDC3C8;
				text-align: center;
				margin-left: 15px;
			}
			.prices1::-webkit-input-placeholder {
				color: #BDC3C8;
			}
			
			
			.price {
				color: #BDC3C8;
				text-align: right;
			}
			
			.prices1 {
				color: #000000;
				text-align: center;
				width:86px;
				text-align:left;
				margin-left: 10px;
			}
			
			.right-add,
			.left-minus {
				width: 35px;
				height: 35px;
				border-radius: 50%;
				background-color: white;
				color: #32BBB1;
			}
			
			.right-add {
				background-image: url(../../image/post/plus.png);
				background-color: #32BBB1;
				background-size: cover;
				background-position: center;
				background-repeat: no-repeat;
			}
			
			.left-minus {
				background-image: url(../../image/post/minus.png);
				background-color: #32BBB1;
				background-size: cover;
				background-position: center;
				background-repeat: no-repeat;
			}
			
			.per {
				font-size:20px;
				text-align:left;
			}
			
			.es {
				color: #A6ACAE;
				font-size: 16px;
				text-align:center;
			}
			
			/*hourly 的价格编辑*/
			.hmoney,.hhour{
				border: 1px solid #babfc1;
				border-radius:13px;
				width: 154px;
				height: 67px;
				line-height: 67px;
				font-size:36px;
			}
			.hmoney{
				margin-left: 12px;
			}
			.currency,
			.htime,
			.pr3::-webkit-input-placeholder {
				color: #BDC3C8;
			}
			.pr1{
				color: #BDC3C8;
			}
			
			.pr2{
				width:90px;
				height: 65px;
				text-align:right;
				border-radius:13px;
				padding: 0 5px 0 15px;
			}
			/*hourly 的金额*/
			.hmoney{
				padding: 0 10px;
			}
			.currency{
				color: #BDC3C8;
				text-align: center;
				position: relative;
			}
			.pr3{
				width:65px;
				text-align: center;
			}
			/*hourly end*/
			.star {
				background-image: url(../../image/post/wujiaoxig.png);
				width:35px;
				height:39px;
				background-size:30px 30px;
				background-repeat: no-repeat;
				background-position: center;
			}
			[data-score='5'] .star-1,
			[data-score='5'] .star-2,
			[data-score='5'] .star-3,
			[data-score='5'] .star-4,
			[data-score='5'] .star-5,
			[data-score='4'] .star-1,
			[data-score='4'] .star-2,
			[data-score='4'] .star-3,
			[data-score='4'] .star-4,
			[data-score='3'] .star-1,
			[data-score='3'] .star-2,
			[data-score='3'] .star-3,
			[data-score='2'] .star-1,
			[data-score='2'] .star-2,
			[data-score='1'] .star-1 {
				width: 35px;
				height: 39px;
				background-size:30px 30px;
				background-repeat: no-repeat;
				background-position: center;
				background-image: url(../../image/star.png);
			}
            input[type='text']::-webkit-input-placeholder {color:#000000;}
			input[type='text']:-moz-placeholder {color:#000000;}
			input[type='text']:-ms-input-placeholder {color:#000000;}			
			
            #wrap{
            	position: relative;
            	/*height:970px;*/
            }			
			#footer {
				/*position: absolute;*/
				width: 100%;
				/*bottom:-17px;*/
			}
			
			.sub {
				background-color: #32BBB1;
				border-radius: 25px;
				text-align: center;
				color: white;
				margin-bottom: 16px;
			}
			
			/*添加图片和删除图片以及加载图片*/
			/*外层添加按钮*/
            .ph-t {
				padding-left: 5px;
			}

			.ph {
				width: 25px;
				height: 25px;
				background-size: 20px 18px;
				background-repeat: no-repeat;
				background-position: center;
				background-image: url(../../image/post/xiangji.png);
			}

			.picture {
				padding: 10px 0;
				border: 1px solid #C3C9CB;
				border-radius: 25px;
				color:#828B90;
				width: 100%;
				font-size: 14px;
				margin-top: 15px;
			}
			/*图片*/
			.img-frm,
			.img {
				position: relative;
				background-repeat: no-repeat;
				background-position: center;
				background-size: cover;
				background: #FFFFFF;
				width:65px;
				height:90px;
			}

			.photo {
				background-repeat: no-repeat;
				background-position: center;
				background-size: 33px 24px;
				background-image: url(../../image/more/xiangji.png);
				width: 33px;
				height: 24px;
			}
            /*关闭按钮*/
			.close {
				z-index: 1;
				position: absolute;
				top: -7px;
				right:-4px;
				font-size: 15px;
				border-radius: 50%;
				background-image: url(../../image/zu-2.png);
				background-repeat: no-repeat;
				background-position: center;
				background-size: 14px 14px;
				width: 20px;
				height: 20px;
			}
            /*竖排 或者横排*/
			.pic {
				position: relative;
				padding-top: 15px;
				height:70px;
				overflow: hidden;
			}

			.pic>.pic-box {
				overflow: hidden;
			}

			ul li {
				position: relative;
				padding-right: 5px;
			}
            /*滑动*/
			#scroller {
				position: absolute;
				z-index: 1;
				width:800px;
				height: 70px;
				-webkit-tap-highlight-color: rgba(0, 0, 0, 0);
				-webkit-transform: translateZ(0);
				transform: translateZ(0);
				-webkit-touch-callout: none;
				-webkit-user-select: none;
				user-select: none;
				-webkit-text-size-adjust: none;
				text-size-adjust: none;
			}

			#scroller ul {
				list-style: none;
				height: 100%;
				width: 100%;
				padding: 0;
				margin: 0;
				height: inherit;
			}
            /*图片的显示个数*/
			#scroller li {
				display: block;
				float: left;
				height: 100px;
				text-align: center;
			}
			/*图片的间距*/
            #scroller .img-frm {
				padding: 0 10px 0 0;
				border-right: 1px solid #E8E8EA;
				position: relative;
				top: -10px;
			}
			
			/*图片的位置和大小*/
			#scroller .img {
				background-size: cover;
				height:80px;
				width:65px;
			}
			
			#scroller ul li:last-child .img-frm {
				border: none;
			}
			
			#scroller h5 {
				padding-right: 10px;
			}
			.add-pic-btn {
				position: relative;
				top: -40px;
				left: 5px;
				padding:12px 0px 8px;
				background-color:#FFFFFF;
				z-index:999;
				width: 65px;
			}
            /*所有图片的总长度*/
			.pl {
				width: 100%;
				height: 100%;
			}

			/*华为按钮调整*/
			@media (max-height:400px){
				.sub{
					display: none;
				}
			}
		</style>
	</head>

	<body>
		<div id="wrap">
			<div id="main">
				<div class="view hidden">
					<div class="flex-box name">
						<div class="flex-1 sty">Favor Title</div>
						<div class="sty">0/50</div>
					</div>
					<div class="text">
						<input type="text" placeholder="" />
					</div>
					<div class="flex-box name">
						<div class="flex-1 sty">Favor Details</div>
						<div class="sty">0/500</div>
					</div>
					<div class="area">
						<textarea name="" rows="4" placeholder=""></textarea>
					</div>
					<!--没照片-->
					<div class="flex-box pic hidden">
						<div class="pic-box">
							<div id="scroller" class="">
								<ul class="no-ul">
									
								</ul>
							</div>
						</div>

						<div class="add-pic-btn " onclick="addPic()">
							<div class=" pl " imgUrl="" data-status="" data-key="" data-callbackEvent="{{= it.callbackEvent}}">
								<div class="imgs-frm">
									<div class="img">
										<div class="upload-status flex-box upload-phot">
											<div class="photo flex-1 status"></div>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>

					<div class="hidden pic-pho flex-box flex-h-ce flex-center-center" onclick="addPic()" tapmode>
						<div class="ph"></div>
						<div class="ph-t"> Upload Attachments</div>
					</div>
					<!--有照片-->
					<div class="flex-box pic hidden">
					<div class="pic-box">
						<div id="scroller" class="">
							<ul class="no-ul"></ul>
						</div>
					</div>
					<div class="add-pic-btn " onclick="addPic()">
						<div class=" pl " imgUrl="" data-status="" data-key="" data-callbackEvent="{{= it.callbackEvent}}">
							<div class="img-frm">
								<div class="img">
									<div class="upload-status flex-box " style="background-color: rgba(209,209,209,0.5);font-size: 11px;">
										<div class="photo flex-1 status"></div>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>

				<div class="picture flex-box flex-h-ce flex-center-center" onclick="addPic()" tapmode>
					<div class="ph"></div>
					<div class="ph-t" lan="UploadAttachments">Upload Attachments</div>
				</div>
					<div class="eva" style="padding: 0px 27px;">
						<div class="title">Difficulty Level</div>
						<div class="flex-box flex-center-center" data-score=''>
							<div class="star star-1" onclick="judge(1)" tapmode></div>
							<div class="star star-2" onclick="judge(2)" tapmode></div>
							<div class="star star-3" onclick="judge(3)" tapmode></div>
							<div class="star star-4" onclick="judge(4)" tapmode></div>
							<div class="star star-5" onclick="judge(5)" tapmode></div>
						</div>
					</div>
					<div class="form">
						<div class="title">How can this favor be completed?</div>
						<div style="padding: 0 30px;">
							<div class="flex-box btn-o">
								<div class="not-tilte btn-tilte  flex-1" onclick="change(this,1)" tapmade>Offline</div>
								<div class="not-tilte  flex-1" onclick="change(this,2)" tapmade>Online</div>
							</div>
						</div>
						<div class="off-d">
							<div class="t">Favor Loction</div>
							<div class="text">
								<input style="padding-top: 3px;" type="text" name="" placeholder="Please fill in the address" value="" />
							</div>
							<div class="t">Due Date</div>
							<div class="date flex-box flex-center-center">
								<input class="flex-1" type="date" />
								<div class="square "></div>
							</div>
						<!--国家-->
						<div class="flex-box">
							<div class="flex-1">
								<div class="t" lan="City">City</div>
								<div class="text flex-box flex-center-center ci" onclick="editselectCity()" tapmode="">
									<input class="flex-1" type="text" tag="" id="city" value="" readonly="readonly"  placeholder=""/>
									<span class="square"></span>
								</div>
							</div>
							<div class="flex-1 margin-left10">
								<div class="t" lan="Province">Province</div>
								<div class="text flex-box flex-center-center pr" onclick="editselectProvince()" tapmode="">
									<input class="" type="text" tag="" id="province" placeholder="" value="eeeee" readonly="readonly" />
								</div>
									<span class="square "></span>
							</div>
						</div>
						<div class="flex-box ">
							<div class="flex-1 ">
								<div class="t" lan="Country">Country</div>
								<div class="text flex-box flex-center-center" onclick="selectCounty()" tapmode="">
									<input class="flex-1 " id="county" name="county" type="text" value="" readonly="readonly" />
									<span class="square "></span>
								</div>
							</div>
							<div class="flex-1 margin-left10 ">
								<div class="t" lan="PostalCode">Postal Code</div>
								<div class="text flex-box flex-center-center ">
									<input class="flex-1 " type="text" id="code" value="" oninput="postalcodeInput(event,this)" />
								</div>
							</div>
						</div>
						<!--end-->
						</div>
						<div class="on-d hidden">
							<div class="t">Due Date</div>
							<div class="date flex-box flex-center-center">
								<input class="flex-1" type="date" />
								<span class="square"></span>
							</div>
						</div>
					</div>
					<div style="padding: 0 60px;">
						<div class="date-btn flex-box flex-center-center">
							<div class="left-minus" onclick="calculation(-1)" tapmode=""></div>
							<div class="flex-1" style="color: white;">
								<span id="count" style="color: #fff;">1</span>
								<span lan="Workers">Workers</span> 
							</div>
							<div class="right-add" onclick="calculation(1)" tapmode=""></div>
						</div>
					</div>
					<div class="hourly hidden">
						<div class="flex-box" style="margin-top: 21px;">
							<div class="eh flex-1">Hourly</div>
							<div class="up-down" onclick="changeMoeny()" tapmode></div>
						</div>
						<div class="flex-box flex-center-center">
							<div class="hhour flex-box" >
								<input class="pr2 " type="number" placeholder="0.0" oninput="wayTwo()" tapmode="" />
								<span class="pr1 flex-1">hr</span>
							</div>
							<div class="hmoney flex-box">
								<span class="currency">$</span> 
								<input class="pr3 " oninput="wayTwo()" tapmode=""  style="text-align: center;padding: 0 0px;"  type="number" placeholder="0.0" />
								<span class="htime">/h</span>
							</div>
						</div>
					</div>
					<div class="total ">
						<div class="flex-box flex-h-zhu" style="margin-top: 21px;">
							<div class="eh flex-1 margin-left15">Total Fix Price</div>
							<div class="up-down" onclick="changeMoeny()" tapmode></div>
						</div>
						<div style="" class="flex-center-center flex-box-v">
							<div class="flex-box money flex-center-center">
								<span class="tprice">C$</span>
								<span class="tpmun">
								    <input class="prices1" type="number" id="cash"  placeholder="0.0" oninput="wayOne()" tapmode="" />
							    </span>
							</div>
						</div>
					</div>
					<div class="flex-box flex-center-center" style="padding: 0 7px; margin-top: 16px;">
						<span class="es ">Estimated Budget</span>
						<span class="per flex-1">
						<span id="simpol">$</span>
						<span id="everyOne">0</span>/ Person</span>
					</div>
				</div>
				<div class="foot hidden" id="footer">
					<div class="sub btn-afavor-1" lan="SAVE" onclick="sub()" tapmode="">SAVE</div>
				</div>				
			</div>
		</div>
	</body>
	<script type="text/template" template="main">
		<div class="view">
			<div class="flex-box name">
				<div class="flex-1 sty" lan="FavorTitle">Favor Title</div>
				<div class="sty"><span id="tnum" style="color:inherit;">0</span>/50</div>
			</div>
			<div class="text">
				<input type="text" placeholder="" id="title" maxlength="50" value="{{=it.title}}" oninput="num()" />
			</div>
			<div class="flex-box name">
				<div class="flex-1 sty" lan="FavorDetails">Favor Details</div>
				<div class="sty"><span id="dnum" style="color:inherit;">0</span>/500</div>
			</div>
			<div class="area">
				<textarea name="" rows="8" placeholder="" id="detail" maxlength="500" oninput="num()">{{=it.details}}</textarea>
			</div>
			<div class="title" lan="Attachments">Attachments</div>
			<!--上传图片和删除图片的修改-->
			{{? it.attachments instanceof Array && it.attachments.length!=0}}
				<div class="flex-box pic ">
					<div class="pic-box">
						<div id="scroller" class="">
							 <ul class="no-ul">
							 	{{ for(var i=0; i<it.attachments.length; i++) { }}
									<li style="width: {{= parseInt((api.frameWidth - 36) / 5)}}px;height: {{= parseInt((api.frameWidth - 36) / 5)}}px;">
											<div class="pl" imgUrl="" data-status="done" data-key="{{=picPath(it.attachments[i])}}" data-callbackEvent="{{= it.callbackEvent}}" onclick="openPhotoBrowser(this)" tapmode="">
												<div class="img-frm">
												<span class="close" style="" onclick="removePic(event, this)" tapmode ></span>
												<div class="img" style="background-image: url({{= Tool.imageCompressByQiNiu(it.attachments[i],0,200,200)}});">
													<div class="upload-status flex-box hidden" style="background-color: rgba(209,209,209,0.5);font-size: 11px;">
														<div class=" flex-1 status"></div>
													</div>
												</div>
											</div>
										</div>
									</li>
								{{ } }}
							 </ul>    
						</div>
					</div>
					<div class="add-pic-btn " onclick="addPic()">
						<div class=" pl " imgUrl="" data-status="" data-key="" data-callbackEvent="{{= it.callbackEvent}}">
							<div class="img-frm">
								<div class="img">
									<div class="upload-status flex-box " style="background-color: rgba(209,209,209,0.5);font-size: 11px;">
										<div class="photo flex-1 status"></div>
									</div>
								</div>
							</div>
						</div>
					</div>
					<div class="picture flex-box flex-h-ce flex-center-center hidden" onclick="addPic()" tapmode="" style="">
						<div class="ph"></div>
						<div class="ph-t" lan="UploadAttachments" style="color: #828B90;">Upload Attachments</div>
					</div>
				</div>
            {{??}}
                <div class="flex-box pic hidden">
					<div class="pic-box">
						<div id="scroller" class="">
							 <ul class="no-ul">
							 </ul>    
						</div>
					</div>
					<div class="add-pic-btn " onclick="addPic()">
						<div class=" pl " imgUrl="" data-status="" data-key="" data-callbackEvent="{{= it.callbackEvent}}">
							<div class="img-frm">
								<div class="img">
									<div class="upload-status flex-box " style="background-color: rgba(209,209,209,0.5);font-size: 11px;">
										<div class="photo flex-1 status"></div>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
				<div class="picture flex-box flex-h-ce flex-center-center" onclick="addPic()" tapmode="" style="">
					<div class="ph"></div>
					<div class="ph-t" lan="UploadAttachments" style="color: #828B90;">Upload Attachments</div>
				</div>
			{{?}}
			<!--难度评价-->
			<div class="eva" style="padding: 0px 27px;">
				<div class="title" lan="DifficultyLevel">Difficulty Level</div>
				<div class="flex-box flex-center-center">
					<div class="flex-box flex-center-center level" data-score='{{=it.level}}'>
						<div class="star star-1" onclick="judge(1)" tapmode></div>
						<div class="star star-2" onclick="judge(2)" tapmode></div>
						<div class="star star-3" onclick="judge(3)" tapmode></div>
						<div class="star star-4" onclick="judge(4)" tapmode></div>
						<div class="star star-5" onclick="judge(5)" tapmode></div>
					</div>
				</div>
			</div>
			<div class="form">
				<div class="title" lan="How_can_this_favor_be_completed">How can this favor be completed?</div>
				<div style="padding: 0 30px;">
					<div class="flex-box btn-o">
						<div lan="Offline" class="not-tilte {{? it.type==1}}btn-tilte{{?}}  flex-1" onclick="change(this,1)" tapmade>Offline</div>
						<div lan="Online" class="not-tilte {{? it.type==2}}btn-tilte-on{{?}}  flex-1" onclick="change(this,2)" tapmade>Online</div>
					</div>
				</div>
				<div class="off-d {{? it.type==2}}hidden{{?}}">
					<div lan="FavorLoction" class="t">Favor Location</div>
					<div class="text">
						<input onclick="address()" tepmode style="padding-top: 0px;" type="text" name="" id="location" placeholder="" value="{{=it.location || ''}}" />
					</div>
					<div class="flex-box">
							<div class="flex-1">
								<div class="t" lan="City">City</div>
								<div class="text flex-box flex-center-center ci" onclick="editselectCity()" tapmode="">
									<input class="flex-1 black" type="text" tag="" id="city" value="" readonly="readonly"  placeholder="{{=Area.getCityName(it.country,it.province,it.city).city.name || ''}}"/>
									<span class="square"></span>
								</div>
							</div>
							<div class="flex-1 margin-left10">
								<div class="t" lan="Province">Province</div>
								<div class="text flex-box flex-center-center pr" onclick="editselectProvince()" tapmode="">
									<input class="black" type="text" tag="" id="province" placeholder="{{=Area.getCityName(it.country,it.province,it.city).province.name || ''}}" value="" readonly="readonly" />
									<span class="square "></span>
								</div>
							</div>
						</div>
						<div class="flex-box ">
							<div class="flex-1 ">
								<div class="t" lan="Country">Country</div>
								<div class="text flex-box flex-center-center" onclick="selectCounty()" tapmode="">
									<input class="flex-1 black" id="county" placeholder="{{=Area.getCityName(it.country,it.province,it.city).country.name || ''}}" name="county" type="text" value="" readonly="readonly" />
									<span class="square "></span>
								</div>
							</div>
							<div class="flex-1 margin-left10 ">
								<div class="t" lan="PostalCode">Postal Code</div>
								<div class="text flex-box flex-center-center ">    
									<input class="flex-1 black" placeholder="" type="text" id="code" value="{{= it.postalcode != 'null' && it.postalcode ? it.postalcode : ''}}" oninput="postalcodeInput(event,this)" />
								</div>
							</div>
						</div>
						<div class="t" lan="DueDate">Due Date</div>
						<div class="date flex-box flex-center-center" onclick="setTime()" tapmode="" >
							<input class="flex-1" id="duedate1"  readonly="readonly" type="text"
								 value="{{? it.type==1}} {{=duedate}} {{?}}"  placeholder="" />
							<div class="square" ></div>
						</div>
				</div>
				<div class="on-d {{? it.type==1}}hidden{{?}}">
					<div class="t" lan="DueDate">Due Date</div>
					<div class="date flex-box flex-center-center" onclick="setTime()"  tapmode="">
						<input class="flex-1" id="duedate2"  type="text"  readonly="readonly" 
							value="{{? it.type!=1}}{{=duedate}}{{??}} {{?}}" placeholder="" />
						<div class="square"></div>
					</div>
				</div>
			</div>
			<div style="width:60%; margin: 0 auto;">
				<div class="date-btn flex-box flex-center-center">
					<div class="left-minus" onclick="calculation(-1)" tapmode=""></div>
					<div class="flex-1" style="color: #fff;">
						<span id="count" style="color: #fff;">{{=it.workers}}</span> 
						<span lan="Workers" style="color: inherit;">Workers</span>
					</div>
					<div class="right-add" onclick="calculation(1)" tapmode=""></div>
				</div>
			</div>
			<div class="hourly {{? it.ishours==0}}hidden{{?}}">
				<div class="flex-box" style="margin-top: 21px;">
					<div class="eh flex-1 margin-left15" lan="Hourly">Hourly</div>
					<div class="up-down" onclick="changeMoeny()" tapmode></div>
				</div>
				<div class="flex-box flex-center-center ">
					<div class="hhour flex-box" >
						<input class="pr2 " type="number" {{? it.ishours==1}}value="{{=it.hourly}}"{{?}} placeholder="0.0" id="time" oninput="wayTwo()" tapmode="" />
						<span class="pr1 flex-1">hr</span>
					</div>
					<div class="hmoney flex-box">
						<span class="currency">{{=it.default_currency == 'cad' ? 'C$' : '$'}}</span> 
						<input class="pr3 " {{? it.ishours==1}}value="{{=parseFloat(it.remuneration1)}}"{{?}}   type="number" placeholder="0.0" id="money" oninput="wayTwo()" tapmode="" />
						<span class="htime">/h</span>
					</div>
				</div>
			</div>
			<div class="total {{? it.ishours==1}}hidden{{?}}">
				<div class="flex-box" style="margin-top: 21px;">
					<div class="eh flex-1 margin-left15" lan="TotalFixPrice">Total Fix Price</div>
					<div class="up-down" onclick="changeMoeny()" tapmode></div>
				</div>
				<div class="flex-center-center flex-box-v">
					<div class="flex-box money flex-h-zhu">
						<span class="tprice">{{=it.default_currency == 'cad' ? 'C$' : '$'}}</span>
						<span class="tpmun">
							<input class="prices1" type="number" id="cash" {{? it.ishours==0}}value="{{=parseFloat(it.remuneration)}}"{{?}}  placeholder="0.0"  oninput="wayOne()" tapmode="" />
						</span>
					</div>
				</div>
			</div>
			<div class="flex-box flex-center-center" style="margin:16px 0;">
				<span class="es flex-1 text-center" lan="EstimatedBudget">Estimated Budget</span>
				<span class="per flex-1 text-center">
				    <span id="simpol">
				  	   {{=it.default_currency == 'cad' ? 'C$' : '$'}}
				    </span>
				    <span id="everyOne">{{=it.budget || 0.00}}</span> / <span style="color: inherit;" lan="Person">Person</span> 
				</span>
			</div>
		</div>
		<div class="foot " id="footer">
			<div class="sub btn-afavor-1" lan="SAVE" onclick="sub()" tapmode="">SAVE</div>
		</div>			
	</script>
	<script type="text/template" template="img">
			<li style="width: {{= parseInt((api.frameWidth - 36) / 5)}}px;height: {{= parseInt((api.frameWidth - 36) / 5)}}px;">
					<div class="pl" imgUrl="" data-status="" data-key="" data-callbackEvent="{{= it.callbackEvent}}" onclick="openPhotoBrowser(this)" tapmode="">
						<div class="img-frm">
						<span class="close" style="" onclick="removePic(event, this)" tapmode></span>
						<div class="img" style="background-image: url({{= it.url}});" >
							<div class="upload-status flex-box " style="background-color: rgba(209,209,209,0.5);font-size: 11px;">
								<div class="flex-1 status"></div>
							</div>
						</div>
					</div>
				</div>
			</li>
	</script>
	<script type="text/javascript" src="../../script/api.js"></script>
	<script type="text/javascript" src="../../script/doT.min.js"></script>
	<script type="text/javascript" src="../../script/common.js"></script>
	<script type="text/javascript" src="../../script/jquery-1.9.1.min.js"></script>
	<script type="text/javascript" src="../../script/upload.js" charset="utf-8"></script>
	<script type="text/javascript" src="../../script/iscroll.js"></script>
	<script type="text/javascript" src="../../res/language.js"></script>
	<script src="../../script/map.js" type="text/javascript" charset="utf-8"></script>
	<script src="../../script/font.js" type="text/javascript" charset="utf-8"></script>
	<script type="text/javascript" src="../../script/area.js"  charset="utf-8"></script>
	<script type="text/javascript" src="../../script/jquery.lazyload.min.js"  charset="utf-8"></script>
	<script type="text/javascript" src="../../script/date.js" ></script>
	<script type="text/javascript">
		var favorid = "";
		var everyOne = parseInt($api.text($api.dom('#everyOne')));
		var title;
		var adds ='';
		var types;
		var duedate1,
		    duedate2,
		    duedate;
		var workers;

		var isadd =1;
		//小时
		var time;
		//每小时的金额 
		var money ='';
		var hPrice ;//修改后每人平均多少钱
		var cash = '';
		//是否按小时收费0为否，1为是
		var ishours =1,
		    budget =''; //每人多少钱原数据
	    var hourly = '',//初始化数据的时间
			remuneration = '',
			remunerations='',
           
            price;  //每人多少钱修改数据
        var countyObj = {},
			provinceObj = {},
			cityObj = {};
			var resend;
		apiready = function() {
			favorid = api.pageParam.favorid;
			resend= api.pageParam.resend;
			var isdue= api.pageParam.isdue;
            if(resend==1 || isdue==1){
				$api.attr($api.dom('.sub'),'lan','REPOST');
				$api.text($api.dom('.sub'),LANGUAGE[$api.getStorage('lan')]['REPOST']);
			}
			init();
			inputBlur(); 
			//alert($api.attr($api.dom('[data-score]'), 'data-score'))
			//监听 已上传完成
            $api.css($api.dom('.pic'), 'height: ' + parseInt((api.frameWidth - 36) / 5 + 15) + 'px;');
			$api.css($api.dom('.add-pic-btn'), 'height: ' + parseInt((api.frameWidth - 36) / 5 + 15) + 'px;background-size: ' + parseInt((api.frameWidth - 36) / 5 + 15) + 'px;');
			$api.css($api.dom('.add-pic-btn'), 'width: ' + parseInt((api.frameWidth - 36) / 5) + 'px');
			api.addEventListener({
				name: 'uploaded'
			},function(ret,err){
				isUpload = 'false';
				if(isUpload == 'false' && files.length > 0) {
					Upload.init({
						files: files,
						callbackEvent: 'uploaded'
					});
					files = []; //上传图片后重置图片数组
					isUpload = 'true';
				}
			});
			//省市选择
			api.addEventListener({
				name: 'editselectCity'
			}, function(ret) {
				var city = $api.val($api.dom('#city'), ret.value.cityInfo.city);
				$api.attr($api.dom('#city'), 'tag', ret.value)
				cityObj = ret.value.cityInfo;
			})
			api.addEventListener({
				name: 'editselectProvince'
			}, function(ret) {
				if(provinceObj.id == ret.value.id) return;
				$api.val($api.dom('#province'), ret.value.city);
				$api.attr($api.dom('#province'), 'tag', JSON.stringify(ret.value))
				provinceObj = ret.value;
				cityObj = {};
				$api.val($api.dom('#city'), '');
				$api.attr($api.dom('#city'), 'tag', JSON.stringify({}))
				if(provinceObj.id == '98' || provinceObj.id == '111') {
					$api.val($api.dom('#city'), provinceObj.city);
				}
			})
		}
	    
		function postalcodeInput(e, _this) {
			var _val = $api.val(_this);
			if(!/^[A-Z0-9]{0,6}$/.test(_val)){
				if(_val.length > 6){
					$api.val(_this, _val.slice(0, 6));
					//将键盘收起
					_this.blur();
				}else{
					Tool.toast('Postal code can only type capital letters or Numbers.');
				}
			}
		}
		//选择国家
		function selectCounty() {
			inputBlur(); //将键盘收下来
			Tool.actionSheet({
				title: 'Choose countries',
				buttons: ['USA', 'CANADA'],
				cancelTitle: 'Cancel',
				success: function(index) {
					if(index == countyObj.id) return;
					if(index == 1) {
						$api.val($api.dom('#county'), 'USA');
						countyObj = {
							id: '1',
							city: 'USA'
						}
						type = 1;
					} else if(index == 2) {
						$api.val($api.dom('#county'), 'CANADA');
						countyObj = {
							id: '2',
							city: 'CANADA'
						}
						type = 2;
					}
					provinceObj = {};
					cityObj = {};
					$api.val($api.dom('#province'),'');
					$api.attr($api.dom('#province'), 'tag', JSON.stringify({}))
					$api.val($api.dom('#city'), '');
					$api.attr($api.dom('#city'), 'tag', JSON.stringify({}))
					$api.val($api.dom('#duedate2'),' ');
				}
			})
		}
		//设置地址
		function address(){
		    adds= $api.val($api.dom('#location'));
			if(!adds){
				$api.val($api.dom('#duedate2'),' ');
			}
		}
		//打开省份
		function editselectProvince(type) {
			var county = $api.val($api.dom('#county'));
			inputBlur(); //将键盘收下来
			if(county == "") {
				Tool.toast("Please choose the country first.")
			} else {
				if(county == "USA") {
					type = 1;
				} else if(county == "CANADA") {
					type = 2;
				}
				api.openWin({
					name: 'ProvinceList',
					url: api.wgtRootDir + '/html/window/post/province_list.html',
					pageParam: {
						type: type
					},
					delay: 300
				});
				$api.val($api.dom('#duedate2'),' ');
			}
		}
        //选择省市
		function  editselectCity() {
			if(provinceObj.id == '98' || provinceObj.id == '111') {
				return;
			}
			inputBlur(); //将键盘收下来
			//判断城市是否是空
			var county = $api.val($api.dom('#county'));
			var province = $api.val($api.dom('#province'));
			if(county == "") {
				Tool.toast("Please choose the country first.")
			} else if(county != "" && province == "") {
				Tool.toast("Please choose the province.")
			} else {
				api.openWin({
					name: 'citys_list',
					url: api.wgtRootDir + '/html/window/post/citys_list.html',
					pageParam: {
						countyid: countyObj.id,
						province: provinceObj
					},
					delay: 300
				});
				$api.val($api.dom('#duedate2'),' ');
			}
		}

		//获取输入的字符数量
		function num() {
			var titleNum = parseInt($api.val($api.dom('#title')).length);
			var detailNum = parseInt($api.val($api.dom('#detail')).length);
			$api.text($api.dom('#tnum'), titleNum);
			$api.text($api.dom('#dnum'), detailNum);
		}
		//价格的编辑
		function changeMoeny() {
			$api.toggleCls($api.dom('.total'), 'hidden');
			$api.toggleCls($api.dom('.hourly'), 'hidden');
		}
		//选择时间
		function setTime() {
			inputBlur(); //将键盘收下来
			var nows = new Date(),
					_year = nows.getFullYear(),
					_month = nows.getMonth() + 1,
					_day = nows.getDate();
					
			_month = _month > 9 ? _month : '0' + _month;
			_day = _day > 9 ? _day : '0' + _day;
			nows = new Date(_year + '-' + _month + '-' + _day).getTime();
			api.openPicker({                
					type: 'date',
					date:'date',
					title: 'Select the date'            
				},
				function(ret, err) {  
					if(ret) {
						var value = ret,
								y = value.year,
								m = value.month > 9 ? value.month : '0' + value.month,
								d = value.day > 9 ? value.day : '0'+value.day,
								time = y + '-' + m + '-' + d,
								dateTime = new Date(time).getTime();
						if(dateTime < nows){
							Tool.toast('Cannot choose the past date.');
							return
						}else {
							if(types==1){
								$api.val($api.dom('#duedate1'),d+'-'+m+'-'+value.year);
							}else if(types==2){
								$api.val($api.dom('#duedate2'),d+'-'+m+'-'+value.year);
								$api.val($api.dom('#duedate1'),' ');
								$api.val($api.dom('#location'),' ');
								$api.val($api.dom('#code'),' ');
								$api.val($api.dom('#city'),' ');
								$api.val($api.dom('#county'),' ');
								$api.val($api.dom('#province'),' ');
							}
							timestatu=1
						}
					}             
				});     
		}
		var  day, //没修改的数据
		     timestatu=0,
		     cityT,
		     countryT,
		     provinceT,
		     ish;
		var ispublic,
		    classid,
		    memberid;
		function init() {
			ajax.get({
				ctrl: 'Favor',
				fn: 'getFavorDetails',
				data: {
					values: {
						id: $api.getStorage(CONFIG.KEY.MEMBER_ID),
						token: $api.getStorage(CONFIG.KEY.TOKEN),
						favorid: favorid
					}
				},
				showError: true,
				showProgress: true,
				hideLoading: true,
				success: function(ct) {
				        day =ct.duedate;
				        timestatu=0;
				    var due1=day.substring(0,4),
					    due2=day.substring(5,7),
					    due3=day.substring(8,10)
					    duedate =due3+'-'+due2+'-'+due1;
					    piclength=ct.attachments;
					    cityT=ct.city;
					    countryT=ct.country;
					    provinceT=ct.province;
					    ish=ct.ishours
					T.html('#main', 'main',ct);
					 if(piclength!=0){
						iscrollInit();
					}
					$api.text($api.dom('#tnum'),ct.title.length);
			        $api.text($api.dom('#dnum'),ct.details.length);
			        var length =parseInt(ct.remuneration.length),
			            timelength=parseInt(ct.hourly.length),
			            moenylength=parseInt(ct.remuneration1.length);
			        wokers=ct.workers;
					cash=ct.remuneration;
					hourly=ct.hourly;
					remunerations=ct.remuneration1;
					types=ct.type;
					ispublic=ct.ispublic;
					classid=ct.classid;
					memberid=ct.memberid;
					if(ish==0){
			        	editOne1(length,cash);
			        }else{
			        	editTwo1(timelength,moenylength,remunerations)
			        }
				    $('.img-picture').lazyload({
						effect: "fadeIn"
					});
					L.init();
				}
			});

		}
		//每人多少钱
		function wayOne() {
			workers=$api.text($api.dom('#count'));
			var allMoney = $api.val($api.dom('#cash')); //总价钱
			var length = $api.trimAll(allMoney),
			    length=parseInt(length.length);
			    editOne(length)
			if(allMoney=='' || cash==''){
				everyOne=budget;
			}else{
				everyOne =allMoney / workers;
			}
			$api.text($api.dom('#everyOne'), Math.round(everyOne*100)/100);
			$api.val($api.dom('#money'),'');
			$api.val($api.dom('#time'),'');
		}
		
		//按小时
		function wayTwo() {
			var timelength = $api.trimAll($api.val($api.dom('#time')));
			timelength=parseInt(timelength.length);
			var moenylength = $api.trimAll($api.val($api.dom('#money')));
			moenylength=parseInt(moenylength.length);
			editTwo(timelength,moenylength);
			$api.val($api.dom('#cash'),' ');
			//每小时的金额
		    workers=$api.text($api.dom('#count'));
			money = $api.val($api.dom('#money'));
			//小时
			time = $api.val($api.dom('#time'));
			if(money=='' || time=='') {
				hPrice = remunerations * hourly / workers;
			}else {
				hPrice = money * time / workers;
			}
			$api.text($api.dom('#everyOne'), Math.round(hPrice*100)/100);
		}

		function calculation(type) {
			/**
			 * type = -1  减法
			 * type = 1 加法
			 * */
			workers = parseInt($api.text($api.dom('#count')));
			if(workers >= 5 && type == 1 || workers <= 1 && type == -1) {
				return;
			}
			var num = workers + type;
			$api.text($api.dom('#count'), num);
			//单价没人多少钱
			if($api.val($api.dom('#cash')) > 0) {
				if(num) {
					price =$api.val($api.dom('#cash'))/ num;
				} else {
					remuneration = $api.val($api.dom('#cash'));
					var nums = $api.text($api.dom('#count'));
					price = remuneration / nums;

				}
				$api.text($api.dom('#everyOne'),Math.round(price*100)/100);
			}
			//每小时的平均每人价格
			if(($api.val($api.dom('#money')) > 0) && ($api.val($api.dom('#time')) > 0)) {
				//每小时的金额
				var money = $api.val($api.dom('#money'));
				//小时
				var time = $api.val($api.dom('#time'));
				if(num) {
					hPrice = money * time / num;
				} else {
					var nums = $api.text($api.dom('#count'));
					hPrice = money * time / nums;
				}
				$api.text($api.dom('#everyOne'),Math.round(hPrice*100)/100);
			}
		}
		//切换线上线下
		function change(_this, type) {
			if(type == 1) {
				$api.removeCls($api.dom('.btn-tilte-on'), 'btn-tilte-on');
				$api.addCls(_this, 'btn-tilte');
				$api.removeCls($api.dom('.off-d '), 'hidden');
				$api.addCls($api.dom('.on-d'), 'hidden')
				types = 1;
				$api.val($api.dom('#duedate2'),' ')
			} else if(type == 2) {
				$api.removeCls($api.dom('.btn-tilte'), 'btn-tilte');
				$api.addCls(_this, 'btn-tilte-on');
				$api.removeCls($api.dom('.on-d'), 'hidden');
				$api.addCls($api.dom('.off-d'), 'hidden');
				types = 2;
			}
		}
        var editType=0 // 判断是否是编辑任务 
		//选择困难级别
		function judge(score) {
			$api.attr($api.dom('[data-score]'), 'data-score', score);
		}
        
		function sub(){
    	//保存图片
    	var imgs = [],
    	    imageList=[];
		var imgDoms = $api.domAll('.pic-box .pl');
		for(var i = 0; i < imgDoms.length; i++) {
			if($api.attr(imgDoms[i], 'data-status') != 'done') {
				console.log($api.attr(imgDoms[i], 'data-status')+','+imgDoms[i])
				Tool.toast('Please complete all information.');
				return;
			}
			imgs.push($api.attr(imgDoms[i], 'data-key'));
		}
		title = $api.val($api.dom('#title'));
		var details=$api.val($api.dom('#detail')),
		    level=$api.attr($api.dom('[data-score]'), 'data-score');
		    adds= $api.val($api.dom('#location'));
		    workers=$api.text($api.dom('#count'));
		    remuneration = $api.val($api.dom('#cash'));
		    duedate1 = $api.val($api.dom('#duedate1'));
		    duedate2 = $api.val($api.dom('#duedate2'));
		    //每小时的金额
			money = $api.val($api.dom('#money'));
			//小时
			time = $api.val($api.dom('#time'));
        var	due=$api.val($api.dom('#offDate'));
            //每小时的金额
			//小时
			time = $api.val($api.dom('#time'));
		var city = cityObj.id; //市
		var province = provinceObj.id; //省
		var country = countyObj.id;  //国家
		var isadd=1;
		var code=$api.val($api.dom('#code'));//邮政编码
	  	    //isadd 是否加钱,1:不是,2:是
			if((ish==0 && ( parseFloat(remuneration)>parseFloat(cash))) || (ish==0 && (money*time>parseFloat(cash)))   || (ish==0&&(  parseFloat(remuneration)<money*time &&  remuneration!=0))){
				isadd = 2
			}else if( (ish==1&&(money*time<parseFloat(remuneration)&& money*time!=0)||(ish==1&&(parseFloat(remuneration)>hourly*remunerations)) || (ish==1 &&(money*time>hourly*remunerations)))){
				isadd = 2
			}else{
				isadd=1;
			}
			var ishours;
			if(parseFloat(remuneration)==0 || money*time!=0){ //ishours是否按小时收费,0为否，1为是 	
				ishours=1
			}else{
				ishours=0
			}
			
			var  due;
			if(types == 1){	//Offline
				if(!$api.trimAll(duedate1)){
					Tool.toast('Please complete all information.');
					return;
				}
				due=duedate1
			}else if(types ==2){	//Online
				if(!$api.trimAll(duedate2)){
					Tool.toast('Please complete all information.');
					return;
				}
				due=duedate2
			}

		var due1=due.substring(0,2),
		    due2=due.substring(3,5),
		    due3=due.substring(6,10),
			due =due3+'-'+due2+'-'+due1, //转换后的日期
			now = new Date(),
			year = now.getFullYear(),
			month = D.formatNum(now.getMonth() + 1),
			date = D.formatNum(now.getDate()),
			nowTs = new Date(year + '-' + month + '-' + date).getTime();
			
		//验证 Due Date 有效性
		if(new Date(due).getTime() < nowTs || new Date(day).getTime() < nowTs){
			Tool.toast('Cannot choose the past date.');
			return;
		}
			
		 //=1是线下 
		if(types==1  && due=='' && country=='' && province=='' && city=='' ){
		 	Tool.toast('Please complete all information.');
		 	return;
		}
	    if(types==1  &&code==''){
	    	Tool.toast('Please complete all information.');
	    	return;
	    }if(types==1  && !adds){
	    	Tool.toast('Please complete all information.');
	    	return;
	    }
	    if(remuneration=='' && money*time==''){
	    	Tool.toast('Please complete all information.');
	    	return;
	    }
	    
	    //过期重新发布
	    if(resend==1){
	    	//线下任务，验证地址有效性
			var provinceName = provinceObj.city,
				cityName = cityObj.city;

			address += ', ' + cityName + ', ' + provinceName;

			api.showProgress({
				title: 'Loading...',
				text: 'Please wait...'
			});
            var lon='',
                lat='';
			getCoordsFromName({
				address: address,
				success: function(location) {
					api.hideProgress();

					lon = location.lng;
					lat = location.lat;

				}
			});
			var values = {
				id: $api.getStorage(CONFIG.KEY.MEMBER_ID),
				token: $api.getStorage(CONFIG.KEY.TOKEN),
				x:types == 1 ? lon : $api.getStorage(CONFIG.KEY.LON),
				y:types == 1 ? lat : $api.getStorage(CONFIG.KEY.LAT),
				title:title,
				details:details,
				attachments:imgs,
				level: level,
				location:adds,
				workers: workers,
				remuneration: remuneration=='' ?cash :remuneration,
				remuneration1:money=='' ? remunerations:money,
				hourly: time ==''? hourly:time,
				ishours: ishours,
				type:types,
				duedate:timestatu==0? day:due,
				country: country=='' ? countryT:country,
				city: city=='' ? cityT:city,
				province: province=='' ?provinceT: province,
				classid: classid,
				ispublic: ispublic,
				memberid: memberid,
				postalcode:code
			}
	    	ajax.get({
				ctrl: 'post',
				fn: 'PostAfavor',
				data: {
					values: values
				},
				showError: true,
				showProgress: true,
				hideLoading: true,
				success: function(ct) {
					//2018-01-24 任务流程调整
					setTimeout(function(){
						api.closeToWin({
							name: 'Init'
						});
					},300);					
return;	//2018-01-24 任务流程调整

					//设置编辑的缓存
					var editData = ct;
				    $api.setStorage('editData', editData);
				    api.openWin({
						name: 'publish',
						url: api.wgtRootDir + '/html/window/publish.html',
						pageParam: {
							frameName: 'fourth_step',
							frameUrl: api.wgtRootDir + '/html/post/fourth_step.html',
							frameParam: {
								editType:editType,
								repost:resend
							},
							headerTitle: LANGUAGE[$api.getStorage('lan')]['Make_A_Favor'],
						},
						reload: true,
						slidBackEnabled: false,
					});
					if(types == 1){
						$api.removeCls($api.dom('.off-d'),'hidden')
						$api.addCls($api.dom('.on-d'),'hidden')
					}else{
						$api.removeCls($api.dom('.on-d'),'hidden')
						$api.addCls($api.dom('.off-d'),'hidden')
					}
				}
			});
        }else{
        	var _val = {
						id: $api.getStorage(CONFIG.KEY.MEMBER_ID),
						token: $api.getStorage(CONFIG.KEY.TOKEN),
						favorid: favorid,
						remuneration1: money=='' ? remunerations:money,
						hourly:time ==''? hourly:time,
						remuneration:remuneration=='' ?cash :remuneration,
						title: title,
						details: details,
						attachments: imgs,
						level:level,
						type: types,
						location: adds,
						country: country=='' ? countryT:country,
						province:province=='' ?provinceT: province,
						city:city=='' ? cityT:city,
						duedate:timestatu==0? day:due,
						workers: workers,
						x: $api.getStorage(CONFIG.KEY.LON) || 116.37156,
				        y: $api.getStorage(CONFIG.KEY.LAT) || 39.981962,
						isadd:isadd,
						postalcode:code,
						ishours:ishours
					};
        	console.log(JSON.stringify(_val));
//      	return;
	        ajax.get({
				ctrl: 'Favor',
				fn: 'editFavor',
				data: {
					values: {
						id: $api.getStorage(CONFIG.KEY.MEMBER_ID),
						token: $api.getStorage(CONFIG.KEY.TOKEN),
						favorid: favorid,
						remuneration1: money=='' ? remunerations:money,
						hourly:time ==''? hourly:time,
						remuneration:remuneration=='' ?cash :remuneration,
						title: title,
						details: details,
						attachments: imgs,
						level:level,
						type: types,
						location: adds,
						country: country=='' ? countryT:country,
						province:province=='' ?provinceT: province,
						city:city=='' ? cityT:city,
						duedate:timestatu==0? day:due,
						workers: workers,
						x: $api.getStorage(CONFIG.KEY.LON) || 116.37156,
				        y: $api.getStorage(CONFIG.KEY.LAT) || 39.981962,
						isadd:isadd,
						postalcode:code,
						ishours:ishours
					}
				},
				showProgress: true,
				hideLoading: true,
				success: function(ct) {
					//设置编辑的缓存
					var editData = ct;
				    $api.setStorage('editData', editData);
					api.execScript({
						frameName: 'my_task_detail',
						script: 'init()'
					});
					api.execScript({
						name: 'Init',
						frameName: 'more',
						script: 'init()'
					});
					//关闭谷歌地图
					api.sendEvent({
					    name: 'googleMapDetail',
					    extra: {
					        detailTpye:1
					    }
					});
	                if(isadd==1){
	                	api.execScript({
							name: 'Init',
							frameName: 'browse_list',
							script: 'TaskList()'
						});
						api.execScript({
						    name:'task_detail',
						    frameName:'my_task_detail',
						    script:'init()'
						});
						api.execScript({
							name:'Init',
							frameName: 'my_promulgator',
							script: 'init()'
						});
					    setTimeout(function() {
							api.closeWin();
						},200);
					}else if(isadd==2){
						api.openWin({
							name: 'publish',
							url: api.wgtRootDir + '/html/window/publish.html',
							pageParam: {
								frameName: 'fourth_step',
								frameUrl: api.wgtRootDir + '/html/post/fourth_step.html',
								frameParam: {
									editType:editType
								},
								headerTitle: LANGUAGE[$api.getStorage('lan')]['Make_A_Favor'],
							},
							reload: true,
							slidBackEnabled: false,
						});
						if(types == 1){
							$api.removeCls($api.dom('.off-d'),'hidden')
							$api.addCls($api.dom('.on-d'),'hidden')
						}else{
							$api.removeCls($api.dom('.on-d'),'hidden')
							$api.addCls($api.dom('.off-d'),'hidden')
						}
					}
					//$api.addCls($api.dom('.off-d'), 'hidden');
				}
			});
        }
		
    }
		var scroll = '';

		var files = [],
			isUpload = 'false';
		var resume = '',
			achieve = '';
		var status = '';
		//点击删除图片
		function removePic(event, _this) {
			event.stopPropagation();
			var picDom = $api.closest(_this, 'li');
			api.confirm({
				title: '',
				msg: 'Delete this photo？',
				buttons: ['No', 'Yes']
			}, function(ret, err) {
				if(ret.buttonIndex == 2) {
					$api.remove(picDom);
					var liDom = $api.domAll('.no-ul > li').length;
					if(parseInt(liDom) == 0){
						$api.addCls($api.dom('.pic'),'hidden');
						$api.removeCls($api.dom('.picture'),'hidden');
					}else{
						$api.removeCls($api.dom('.add-pic-btn'),'hidden');
					}
					iscrollInit();
				}
			});
		}

		function renderImg(args) {
			T.append('.pic .no-ul', 'img', args)
			iscrollInit();
			setTimeout(function(){
				var imgDoms = $api.domAll('.pic-box .pl');
				if(imgDoms.length==0){
					scroll.scrollToElement(imgDoms[imgDoms.length], 200);
				}else{
                    scroll.scrollToElement(imgDoms[imgDoms.length-1], 200);					
				}
			},100);
		}
		//upload按钮
		function addPic() {
			inputBlur();
			Tool.actionSheet({
				title: 'Upload pictures',
				buttons: ['Camera', 'Choose from album'],
				success: function(type) {
					if(type < 3) {
						if(!/^wifi$/i.test(api.connectionType)) {
							api.confirm({
								title: '',
								msg: 'The current network environment is：' + api.connectionType + 'Will generate data traffic, whether to continue uploading?',
								buttons: ['No', 'Yes']
							}, function(ret, err) {
								if(ret.buttonIndex == 2) {
									if(type == 1) {
										getPhone();
									} else {
										getalbum();
									}
								}
							})
						} else {
							if(type == 1) {
								getPhone();
							} else {
								getalbum();
							}
						}
					}
				}
			})

		}
		//upload按钮拍照获得一张照片
        function getPhone(){
        	var picDom = $api.domAll('.pic-box .pl');
			if(picDom.length < 9) {
				Tool.getOnePic({
					sourceType: 'camera',
					success: function(ret) {
						if(ret) {
							$api.removeCls($api.dom('.pic'), 'hidden');
						    $api.addCls($api.dom('.picture'), 'hidden')
							var callbackEvent = 'uploadPic' + new Date().getTime(),
							args = {
								url: ret.data,
								callbackEvent: callbackEvent
							};
							files.push(args);
							renderImg(args);
							if(isUpload == 'false') {
								Upload.init({
									files: files,
									callbackEvent: 'uploaded'
								});
								files = [];
								isUpload = 'true';
							}
						}
					}
				});
			}
        }
		//upload按钮从相册获得一张图片
        function getalbum(){
        	var ul = $api.dom('.pic-box'),
				li = $api.domAll(ul, '.pl'),
				max = '';
			if(li.length > 0) {
				max = 9- parseInt(li.length);
			} else {
				max = 9;
			}
			if(li.length < 9) {
				Tool.getSomePic({
					max: max,
					selectedMaxText: 'Select a maximum of ' + max + ' photos',
					success: function(ret) {
						if(ret.eventType=='cancel'){
							$api.addCls($api.dom('.pic'), 'hidden');
						    $api.removeCls($api.dom('.picture'), 'hidden');
						    return;
						}
						if(!ret || parseInt(ret.list.length) == 0) {
							return;
						}else{
							$api.removeCls($api.dom('.pic'), 'hidden');
						    $api.addCls($api.dom('.picture'), 'hidden')
						}
						for(var i = 0; i < ret.list.length; i++) {
							var args = {
								url: ret.list[i].path,
								callbackEvent: 'uploadPic' + new Date().getTime() + i
							}
							files.push(args);
							renderImg(args);
						}
						if(isUpload == 'false') {
							Upload.init({
								files: files,
								callbackEvent: 'uploaded'
							});
							files = []; //上传图片后重置图片数组
							isUpload = 'true';
						}
					}
				});
			}
        }

		function iscrollInit() {
			var menuDom = $api.dom('.pic #scroller'),
				liDoms = $api.domAll(menuDom, 'li');
			width = 0;

			for(var i = 0, len = liDoms.length; i < len, g = liDoms[i]; i++) {
				width += $api.offset(liDoms[i]).w;
			}
			width += 1;
			$api.css($api.dom('.pic #scroller'), 'width:' + width + 'px');
			if(liDoms.length == 9) {
				$api.css($api.dom('.pic>.pic-box'), 'width: ' + $api.offset(liDoms[0]).w * 5 + 'px;');
				$api.addCls($api.dom('.add-pic-btn'), 'hidden');
			} else if(liDoms.length > 4) {
				$api.css($api.dom('.pic>.pic-box'), 'width: ' + $api.offset(liDoms[0]).w * 4 + 'px;');
				$api.removeCls($api.dom('.add-pic-btn'), 'hidden');
			} else {
				$api.css($api.dom('.pic>.pic-box'), 'width: ' + width + 'px;');
				$api.removeCls($api.dom('.add-pic-btn'), 'hidden');
			}
			scroll = new IScroll('.pic>.pic-box', {
				eventPassthrough: true,
				scrollX: true,
				scrollY: false,
				preventDefault: false,
				mouseWheel: true
			});
			$api.dom('.pic>.pic-box').addEventListener('touchmove', function(e) {
				e.preventDefault();
			}, false);
		}
	    function openPhotoBrowser(_this){
		  	//保存图片
        	var imgs = [],
        		keys = [];
			var imgDoms = $api.domAll('.pic-box .pl');
			for(var i = 0; i < imgDoms.length; i++) {
				imgs.push('http://osiq15wvv.bkt.gdipper.com/'+$api.attr(imgDoms[i], 'data-key'));
				keys.push($api.attr(imgDoms[i], 'data-key'));
			}
			var key = $api.attr(_this, 'data-key');
			var index = 0;
			for(var j = 0; j < keys.length; j++){
				if(key === keys[j]){
					index = j;
					break ;
				}
			}
			console.log(keys);
			console.log(key);
			console.log(index)
            Tool.openPhotoBrowser({
				images:imgs,
				activeIndex:index,
				bgColor: 'rgba(0,0,0, 0.5)',
				click: function(photoBrowser) {
					photoBrowser.close();
				}
			});
			console.log(JSON.stringify(imgs,null,2)+'图片组')
        }
	</script>

</html>