<!doctype html>
<html lang="en">

	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0" />
		<meta name="format-detection" content="telephone=no">
		<title>我的任务-已完成的任务-帮助者 </title>
		<link rel="stylesheet" type="text/css" href="../../css/ct.css" />
		<style type="text/css">
			.list-item {
				border-bottom: 1px solid #E9E9E9;
				padding: 17px 12px 14px 15px;
				height: 90px;
			}

			.title {
				display: -webkit-box !important;
				overflow: hidden;
				text-overflow: ellipsis;
				word-break: normal;
				-webkit-box-orient: vertical;
				-webkit-line-clamp: 2;
				font-size: 16px;
				margin-bottom: 5px;
				margin-top: 8px;
				margin-right: 10px;
				min-height: 32px;
				word-wrap: break-word;
			}

			.line {
				display: -webkit-box !important;
				overflow: hidden;
				text-overflow: ellipsis;
				word-break: break-all;
				-webkit-box-orient: vertical;
				-webkit-line-clamp: 2;
			}

			.text {
				font-size: 11px;
				color: #868686;
				overflow: hidden;
				text-overflow: ellipsis;
				white-space: nowrap;
				max-width: 130px;
			}

			.text1 {
				font-size: 11px;
				color: #868686;
				margin-bottom: 10px;
			}

			.text2 {
				font-size: 11px;
				color: #868686;
				margin-bottom: 6px;
			}

			.content {
				padding: 0 5px 0 10px;
			}

			.num {
				color: #3EBBB2;
				font-size: 26px;
				margin-bottom: 10px;
				margin-right: 10px;
			}

			.img-frm,
			.img {
				width: 64px;
				height: 64px;
				border-radius: 50%;
				background-repeat: no-repeat;
				background-position: center;
				background-size: cover;
			}

			.ic {
				margin-right: 5px;
				background-repeat: no-repeat;
				background-position: center;
				background-size: cover;
				width: 11px;
				height: 15px;
				background-image: url(../../image/browse/2.png);
			}

			span {
				color: #83D3D0;
			}

			.money {
				text-align: center;
				min-width: 50px;
			}

			.img1 {
				height: 13px;
			}

			.love {
				margin-top: 8px;
				height: 20px;
			}

			.no_collect {
				background-image: url(../../image/browse/heart-line.png);
			}

			.collect {
				background-image: url(../../image/browse/heart-bold.png);
			}

			.coll {
				width:46px;
				height: 20px;
				background-repeat: no-repeat;
				background-position: center;
				background-size:17px 16px;
				position: absolute;
				right:0px;
			}

			.price_box {
				text-align: right;
			}
			span[lan]{
				color: inherit;
			}
		</style>
	</head>

	<body>
		<div id="wrap">
			<div id="main">
				<div class="list hidden">
					<div class="list-item flex-box flex-h-ce">
						<div class="img"></div>
						<div class="content flex-1 line-clamp-2">
							<div class="info">
								<div class="title">
									165161564616166161616184165161564616166161616184165161564616166161616184
								</div>
								<div class="flex-1 flex-box flex-h-ce">
									<div class="ic"></div>
									<div class="flex-1 text">271 Veum circle suite 146</div>
								</div>
								<div class="text1">17 Comments ,8 Offers</div>
							</div>
						</div>
						<div class="price_box">
							<div class="love" onclick="" tapmode>
								<div class="no_collect img-1 coll"></div>
							</div>
							<div class="num ">$99</div>
							<div class="text2">3 km away</div>
						</div>
					</div>
					<div class="list-item flex-box flex-h-ce">
						<div class="img"></div>
						<div class="content flex-1">
							<div class="info">
								<div class="title">Assemble IKEAsofabed and removeAssemble IKEAsofabed and removeAssemble IKEAsofabed and remove</div>
								<div class="flex-1 flex-box flex-h-ce">
									<div class="ic"></div>
									<!--<icon></icon>-->
									<div class="flex-1 text">271 Veum circle suite 146</div>
								</div>
								<div class="text1">17 Comments ,8 Offers</div>
							</div>
						</div>
						<div class="flex-center-center flex-box-v">
							<div class="love flex-1 " onclick="" tapmode>
								<div class="collect img-1 coll">
								</div>
							</div>
							<div class="num ">$299994</div>
							<div class="text2">3 km away</div>
						</div>
					</div>

					<div class="list-item flex-box flex-h-ce">
						<div class="img"></div>
						<div class="content flex-1">
							<div class="info">
								<div class="title">Assemble IKEAsofabed and removeAssemble IKEAsofabed and removeAssemble IKEAsofabed and remove</div>
								<div class="flex-1 flex-box flex-h-ce">
									<div class="ic"></div>
									<div class="flex-1 text">271 Veum circle suite 146</div>
								</div>
								<div class="text1">17 Comments ,8 Offers</div>
							</div>
						</div>
						<div class="price_box">
							<div class="love" onclick="" tapmode>
								<div class="no_collect img-1 coll">
								</div>
							</div>
							<div class="num ">$004</div>
							<div class="text2">3 km away</div>
						</div>
					</div>
					<div class="list-item flex-box flex-h-ce">
						<div class="img"></div>
						<div class="content flex-1">
							<div class="info">
								<div class="title">Assemble IKEAsofabed and removeAssemble IKEAsofabed and removeAssemble IKEAsofabed and remove</div>
								<div class="flex-1 flex-box flex-h-ce">
									<div class="ic"></div>
									<!--<icon></icon>-->
									<div class="flex-1 text">271 Veum circle suite 146</div>
								</div>
								<div class="text1">17 Comments ,8 Offers</div>
							</div>
						</div>
						<div class="">
							<div class="love flex-1 " onclick="" tapmode>
								<div class="collect img-1 coll">
								</div>
							</div>
							<div class="num flex-1">$214</div>
							<div class="text2">3 km away</div>
						</div>
					</div>

					<div class="list-item flex-box flex-h-ce">
						<div class="img"></div>
						<div class="content flex-1">
							<div class="info">
								<div class="title">Assemble IKEAsofabed and removeAssemble IKEAsofabed and removeAssemble IKEAsofabed and remove</div>
								<div class="flex-1 flex-box flex-h-ce">
									<div class="ic"></div>
									<div class="flex-1 text">271 Veum circle suite 146</div>
								</div>
								<div class="text1">17 Comments ,8 Offers</div>
							</div>
						</div>
						<div class="price_box">
							<div class="love" onclick="" tapmode>
								<div class="no_collect img-1 coll">
								</div>
							</div>
							<div class="num ">$004</div>
							<div class="text2">3 km away</div>
						</div>
					</div>

				</div>
			</div>
		</div>
	</body>
	<script type="text/javascript" src="../../script/api.js"></script>
	<script type="text/javascript" src="../../script/doT.min.js"></script>
	<script type="text/javascript" src="../../script/common.js"></script>
	<script type="text/javascript" src="../../script/area.js" charset="utf-8"></script>
	<script type="application/javascript" src="../../script/area.js"></script>
	<script type="text/javascript" src="../../script/jquery-1.9.1.min.js"></script>
	<script type="text/javascript" src="../../script/jquery.lazyload.min.js"></script>
	<script type="text/javascript" src="../../script/browse.js"></script>
	<script type="text/javascript" src="../../script/browse_list.js"></script>
	<script type="text/javascript" src="../../res/language.js"></script>
	<script type="text/template" template="main">
		{{? it instanceof Array && it.length != 0}}
		<div class="list">
			{{~ it: value:index}}
			<div id="afavor{{= value.id}}" class="list-item flex-box flex-h-ce" onclick="openTaskDetail({{= value.id}})" tapmode="">
				<div class="img" style="background-image:url({{=Tool.imageCompressByQiNiu(value.avatar,0,200,200)}})"></div>
				<div class="content flex-1 {{= api.systemType == 'ios' ? 'line-clamp-2' : '' }}">
					<div class="info">
						<div class="title" data-content="{{= value.title}}">
							{{= value.title}} 
						</div>
						<div class="flex-1 flex-box flex-h-ce">
							<div class="ic"></div>
							<div class="flex-1 text">
								{{? value.type == 1 && value.isself==2}}
								    {{=value.location || ''}}
									{{=Area.getCityName(value.country,value.province,value.city).city.name || ''}}, 
									{{=Area.getCityName(value.country,value.province,value.city).province.name || ''}}
								{{?? value.type == 1 && value.isself!=2}}
								    {{=Area.getCityName(value.country,value.province,value.city).city.name || ''}}, 
									{{=Area.getCityName(value.country,value.province,value.city).province.name || ''}}
								{{?? value.type ==2}}
								  	<span lan="Online">
								  		{{= LANGUAGE[$api.getStorage('lan')]['Online'] }}
								  	</span>
								{{?}}
							</div>
						</div>
						<div class="text1">
							{{? value.comments==0}} 
								0 
								<span lan="Comment">
									{{= LANGUAGE[$api.getStorage('lan')]['Comment'] }} 
								</span>
							{{?? value.comments==1}} 
								1 
								<span lan="Comment">
									{{= LANGUAGE[$api.getStorage('lan')]['Comment'] }} 
								</span>
							{{??}}
								{{= value.comments}} 
								<span lan="Comments">
									{{= LANGUAGE[$api.getStorage('lan')]['Comments'] }} 
								</span>
							{{?}} , 
							
							{{? value.offers==0}} 
								0 
								<span lan="Offer">
									{{= LANGUAGE[$api.getStorage('lan')]['Offer'] }} 
								</span>
							{{?? value.offers==1}} 
								1 
								<span lan="Offer">
									{{= LANGUAGE[$api.getStorage('lan')]['Offer'] }} 
								</span>
							{{??}} 
								{{= value.offers}} 
								<span lan="Offers">
									{{= LANGUAGE[$api.getStorage('lan')]['Offers'] }} 
								</span>
							{{?}}
						</div>
					</div>
				</div>
				<div class="price_box">
					<div class="love flex-1">
						<div  onclick="collect(this, event,{{= value.id}})" tapmode class="{{= value.collection == 0 ? 'no_collect' : 'collect'}} img-1 coll">
						</div>
					</div>
					<div class="num flex-1">{{=default_currency == 'cad' ? 'C$' : '$'}}{{= value.total}}</div>
					{{? value.type == 1}}
					   <div class="text2">{{= formatDistance(value.distance)}} away</div>
					{{?}}
				</div>
			</div>
			{{~}}
		</div>
		{{??}}
		<div class="null flex-box">
			<div lan="No_relevant_content">No relevant content.</div>
		</div>
		{{?}}

	</script>
	<script type="text/javascript">
		//请求参数
		var values = {
				id: $api.getStorage(CONFIG.KEY.MEMBER_ID),
				token: $api.getStorage(CONFIG.KEY.TOKEN),
				country: '',
				province: '',
				city: '',
				distance1: 0,
				distance2: 10,
				x: $api.getStorage(CONFIG.KEY.LON), //经度
				y: $api.getStorage(CONFIG.KEY.LAT), //纬度
				//					name: '',
				page: 1
			},
			loadMoreValues = {
				id: $api.getStorage(CONFIG.KEY.MEMBER_ID),
				token: $api.getStorage(CONFIG.KEY.TOKEN),
				country: '',
				province: '',
				distance1: 0,
				distance2: 10,
				//					name: '',
				city: '',
				x: $api.getStorage(CONFIG.KEY.LON), //经度
				y: $api.getStorage(CONFIG.KEY.LAT), //纬度
				page: 1
			},
			default_currency = '';

		apiready = function() {
//			alert(api.frameWidth - 145)
			//监听选择国家省份城市
			api.addEventListener({
				name: 'task'
			}, function(ret) {
				api.closeWin({
					name: 'Discovery'
				});
				var value = ret.value;
				if(value.province) {
					values.page = 1;
					values.country = value.country.id;
					values.province = value.province.id;
					values.city = value.city.id;
				} else {
					values = {}
				}
				TaskList();
			});

			Refresh.init({
				ctrl: 'Browse',
				fn: 'getNearList',
				field: 'list',
				values: values,
				success: function() {
//					fixTitle($api.domAll('.list-item'));
					$('div.img').lazyload({
						effect: "fadeIn"
					});
				}
			});

			LoadMore.init({
				ctrl: 'Browse',
				fn: 'getNearList',
				values: loadMoreValues,
				//				container: '.list',
				countSelector: '.list > div',
				template: 'main',
				field: 'list',
				success: function(ct, page) {
//					fixTitle($('.list-item').slice((page - 1) * 10));
					$('div.img').slice((page - 1) * 10).lazyload({
						effect: "fadeIn"
					});
				}
			});
			
			//用户切换城市
			api.addEventListener({
				name: 'changeLocation'
			}, function(ret){
				var cityInfo = ret.value.cityInfo,
					provinceInfo = ret.value.provinceInfo;
				
				//用于地图定位
				$api.setStorage('currentLocationInfo', ret.value);
				
				values.country = loadMoreValues.country = provinceInfo.country;
				values.province = loadMoreValues.province = provinceInfo.id;
				values.city = loadMoreValues.city = cityInfo.id;
				TaskList(1, ret.value);
			});
			
			//根据用户当前位置信息，获取附件任务信息
			api.addEventListener({
				name: 'getUserLocation'
			}, function(ret){
				values.country = loadMoreValues.country = '';
				values.province = loadMoreValues.province = '';
				values.city = loadMoreValues.city = '';
				
				values.x = loadMoreValues.x = $api.getStorage(CONFIG.KEY.LON);
				values.y = loadMoreValues.y = $api.getStorage(CONFIG.KEY.LAT);
				TaskList();
			});
			
			//数据筛选
			api.addEventListener({
				name: 'search_browse'
			}, function(ret) {
				if(ret && ret.value) {
					var value = ret.value,
						types = value.types,
						distance = value.distance;
						
					values.orderby = loadMoreValues.orderby = value.sort;
					if(value.favortype != 0) {
						values.favortype = loadMoreValues.favortype = value.types;
					}
					if(value.distance != '') {
						var distance1 = value.distance.substring(0, value.distance.indexOf(',')),
							distance2 = value.distance.substring(value.distance.indexOf(',') + 1);
							distance1 = parseInt(distance1) * 5;
							distance2 = parseInt(distance2) * 5;

							values.distance1 = loadMoreValues.distance1 = distance1;
							values.distance2 = loadMoreValues.distance2 = distance2;
					}
					TaskList();	
				}
			});
//
			//监听收藏
			api.addEventListener({
				name: 'collect'
			}, function(ret) {
				if(ret && ret.value && ret.value.fid) {
					// var _dom = $api.dom('#afavor' + ret.value.fid + ' .love div');
					var _dom = $('#afavor' + ret.value.fid + ' .love div');
					_dom.removeClass('no_collect')
						.removeClass('collect')
						.addClass(ret.value.isCollect ? 'collect' : 'no_collect');
				}
			});
			
			//获取任务列表
			TaskList();
			
		} /*end apiready*/

		//搜索任务
		function search(name) {
			loadMoreValues.name = values.name = name;
			TaskList();
		}
	</script>

</html>
